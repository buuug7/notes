
# DNS and how it works?

DNS(Domain Name System) 域名系统是用来把域名解析成IP地址的一个系统, 简而言之, 它是一个存储所有域名和对应IP地址的数据库, 并执行此转换工作.



## step 1 查询本地缓存

当开始访问一个域名的时候, 首先去查询本地缓存(查询本地缓存首先去浏览器缓存中查询, 如果不存在则去操作系统的host文件中查找)中是否有对应的信息,如果有对应的IP信息,会直接返回然后访问, 如果不存在则进行 step2 步骤.

这里还涉及到另外一个概念就是缓存的 TTL, TTL (Time to Live)是每个DNS记录的设置，它指定解析器在查询过期之前应该缓存(或记住)DNS查询的时间.

## step 2 递归查询 ISP server

如果本地没有查询到缓存, 则会以递归的方式询问ISP服务. ISP的递归服务也有缓存, 所以你的查询通常到这里就会结束了.


## step 3 查询根域名服务器

如果ISP服务器并不知道你查询域名地址, 那么就要去查询根域名服务器. 全球13 DNS 服务器扮演者一个类似于电话簿的角色.

## step 4  查询 TDL 服务器

当根域名服务器收到你的请求后, 会将查询的域名拆分开. 比如查询`www.baidu.com`, 那么会从右往左拿到.com并定向查询TDL(顶级域名查询). 

## step 5 询问权威服务器

顶级域名会审阅我们的请求并拿到 `baidu.com`这部分, 将这个查询定向到权威服务器上去, 这些权威服务器负责了该特定域名的所有信息查询.

## step 6 取回查询到的记录到ISP

现在我们查询到了这个记录, ISP服务器将会取回这个记录并缓存(基于TTL)以备未来所需, 当然在TTL 过期之后, 会重新进行一次从下往上的查找以保证缓存数据的实时性.

## step 7 从ISP取回这个记录

ISP获得记录后会返回给发起请求查询的电脑, 我们的浏览器会将这个记录缓存, 然后浏览器根据这个IP去获取信息.


## 关于顶级域名的划分

例如, `baidu.com`是一个顶级域名, `www.baidu.com`不是一个顶级域名, 只是顶级域名`baidu.com`上的一个 www 主机.也可以称为二级域名.


